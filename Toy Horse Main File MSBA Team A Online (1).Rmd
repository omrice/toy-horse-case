---
title: "Toy Horse Main File"
author: "MSBA Online Team A"
date: "December 6, 2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load the data and any libraries as well as sourcing any .R software files. You should source your ConjointCode.R file

```{r loadData}
##Insert code to load the data here
setwd("/Users/tomohiromiyachi/Analytics Design")
load("GBA424 Fall 2020 - Toy Horse Case Data.Rdata")
```


\section{Part A: Regressions}
Include here analysis that produces the part-utilities at the individual level. These will be data to pass to part B. In addition, use these estimates to do the predictions of the missing profiles and to create a complete set of profile ratings to be used in part D. 

```{r individualLevelRegressions}
###Insert code here

coefs = matrix(nrow = nrow(respondentData), ncol = ncol(conjointData) - 1)
coefsDF = as.data.frame(coefs)

col_titles = c("ID","Intercept","price","size", "motion", "style")
colnames(coefsDF) = col_titles

for(i in 1:nrow(respondentData)){
  coefsDF[i,1] = i
  coefsDF[i,2:6] = lm(ratings ~ price + size + motion + style, data = conjointData[conjointData$ID == i,])$coef
}

conjointDataComplete = conjointData

for(i in 1:nrow(conjointDataComplete)){
  if(is.na(conjointDataComplete[i, "ratings"])) {
    conjointDataComplete[i, "ratings"] = coefsDF$Intercept[coefsDF$ID == conjointDataComplete[i, "ID"]] + 
      conjointDataComplete[i, "price"]*coefsDF$price[coefsDF$ID == conjointDataComplete[i, "ID"]] +
      conjointDataComplete[i, "size"]*coefsDF$size[coefsDF$ID == conjointDataComplete[i, "ID"]] + 
      conjointDataComplete[i, "motion"]*coefsDF$motion[coefsDF$ID == conjointDataComplete[i, "ID"]] + 
      conjointDataComplete[i, "style"]*coefsDF$style[coefsDF$ID == conjointDataComplete[i, "ID"]]
  } else {
    next
  }
}

```

\section{Part B: Post-hoc Segmentation}

In this section, wse cluster analysis on the part-utilities (including the constant) to identify the best post-hoc segmentation scheme. Test at least two cluster analysis schemes (i.e., number of clusters) and select the best one in your view. Justify this decision. Then profile the segments in the chosen scheme and identify the ideal product for each segment. See if you can identify any other strategic issues arising from the segmentation (e.g., menu pricing opportunities, competitive considerations, target/customization).

```{r postHocSegmentation}
##Insert code here
library(cluster) 
library(fpc)
library(foreign)

set.seed(1234)
toClust = coefsDF[,2:6]
source("FunctionDoc.R")
tmp = clustTest(toClust)

clusts = runClusts(toClust,2:3)
plotClust(clusts$kms[[1]],toClust)
plotClust(clusts$kms[[2]],toClust)
```

Looking at the graphs and using the elbow rule, it indicates that we should select three cluster. Moreover, the graphs of the different clusters very clearly indicate that there should be 3 distinct clusters. When comparing the cluster means we also see significant differences between the three clusters implying that we should also select three.

The ideal product for cluster 1 would be $119.99, 26 inches, bouncing motion, in a racing style.
The ideal product for cluster 2 would be $119.99, 18 inches, rocking motion, in a glamour style.
The ideal product for cluster 3 would be $119.99, 26 inches, rocking motion, in a glamour style.

Some issues coming from these segments are clearly the price and size for clusters 1 and 2 of their ideal products. These larger horses cost more and as such the cheaper price does not always make it possible for firms to produce and maintain profits. The same goes with the rocking motion and price of clusters 2 and 3 as these rocking horses are more expensive to produce and can make it difficult to have positive profits.

\section{Part C: A Priori Segmentation}

Conduct a priori segmentation analyses using the variables gender and age in order to profile the attribute preferences based on these variables (use segment-level regressions). Test whether these a priori segmentation variables affect the part-utilities. What does this test tell you about these as segmentation schemes? If the differences are meaningful, profile the segment-level attribute preferences and identify the ideal product for each of the relevant a priori segments. See if you can identify any other strategic issues arising from the segmentation (e.g., menu pricing opportunities, competitive considerations, target/customization).

```{r aPrioriSegmentation}
##Provide code here

conjointDataSegment = conjointDataComplete
conjointDataSegment$gender = NA
conjointDataSegment$age = NA

respondentDataSegments = respondentData 

for(i in 1:nrow(conjointDataComplete)){
  conjointDataSegment[i, "gender"] = respondentDataSegments$gender[respondentDataSegments$ID == conjointDataSegment[i, "ID"]]
  conjointDataSegment[i, "age"] = respondentDataSegments$age[respondentDataSegments$ID == conjointDataSegment[i, "ID"]]
}

Reg1 = lm(ratings ~ price + size + motion + style + price*gender + size*gender + motion*gender + style*gender, data = conjointDataSegment)
Reg2 = lm(ratings ~ price + size + motion + style + price*age + size*age + motion*age + style*age, data = conjointDataSegment)

summary(Reg1)
summary(Reg2)

Reg3 = lm(ratings ~ price + size + motion + style, data = conjointDataSegment, subset = gender == 0)
Reg4 = lm(ratings ~ price + size + motion + style, data = conjointDataSegment, subset = gender == 1)

summary(Reg3)
summary(Reg4)
```

Looking at the summaries of each regression where age and gender were introduced as an interaction variable, we see that when age was introduced style became insignificant, age was insignificant, and only two of the interactions (size:age and motion:age) were significant. When gender was introduced, we see that motion was not significant but all other factors were. From there we decided to observe the segments when gender was equal to 0 (male) or gender was equal to 1 (female). What we saw was that for male children's ideal product had a price of 119.99, was 26 inches, and came in the racing style. Our model also provided a negative coefficient for motion, meaning they would prefer bouncing, however this measure was not significant so we cannot trust the validity of this measure in determining that for this segment. The female children's ideal product had a price of 119.99, was 26 inches, had a rocking motion, and came in the glamour style.

There are feasibility issues with both of these segments ideal product. First, both groups wanted the cheaper price and the larger size. The larger size costs more to produce and as such charging less shrinks the firms possible profits. Second, the male group also wants a rocking motion. This again increases the cost of producing these products and are not very conducive to a lower price.

\section{Part D: Market Simulation}

Use disaggregate analysis with a first choice rule to forecast market shares for a decision-relevant set of scenarios. Using these market shares and the information about costs in the case, calculate profitability for each product in the product line as well as the overall profitability for the firm and competition. You should present at least 4 scenarios that try to identify the best possible product line strategy (policy) given considerations related to competitive response, cannibalization, profitability, and long-run profitability. Be sure to briefly justify why you chose the scenarios you chose to analyze!


```{r marketSimulation}

#Creating the matrix with users and the ratings

fullMarketRatings = data.frame("ID" = 1:200, "profile1" = NA, "profile2" = NA, "profile3" = NA, "profile4" = NA, 
                               "profile5" = NA, "profile6" = NA, "profile7" = NA, "profile8" = NA, "profile9" = NA, "profile10" = NA,
                               "profile11" = NA, "profile12" = NA, "profile13" = NA, "profile14" = NA, "profile15" = NA,
                               "profile16" = NA)
for(i in 1:nrow(fullMarketRatings)){
  for(j in 1:16){
    fullMarketRatings[i,j+1] = conjointDataComplete$ratings[conjointDataComplete$ID == i & conjointDataComplete$profile == j]
  }
}


#profile 13 and profile profile 5 are the same as our current offers
#profile 7 is our competitors rocking horse
#these profiles cwill be included in each scenario to track canibilization of our own products and stolen share from out competitors

source("FunctionDoc.R")

testScen = list()
testScen[[1]] = c(6,8,14) #Current market
testScen[[2]] = c(6,8,14,10,2) #Change motion keep sizing the same, keep old products
testScen[[3]] = c(6,9,14,10,2) #Competitor responds by lowering price
testScen[[4]] = c(8,7,15) #Lower our prices
testScen[[5]] = c(9,7,15) #Comepetitor responds by lowering price
testScen[[6]] = c(9,8,17) #increase size and lower price
testScen[[7]] = c(9,17) #Competitor responds by lowering price
testScen[[8]] = c(7,8,15,11,3) #add lines of the exact same thing as our but different the motion, lower the price for new and old lines
testScen[[9]] = c(7,9,15,11,3) #competitor lowers price
testScen[[10]] = c(6,8,14,11,3) #try new lines above but keep our original lines
testScen[[11]] = c(6,9,14,11,3) #competitor lowers price
testScen[[12]] = c(7,8,15,3) #drop our prices, add a line of bouncing horses
testScen[[13]] = c(7,9,15,3) #competitor lowers price

scenariosShare = simScenarios(testScen, fullMarketRatings)
scenariosShare

EarlyRiders_Offerings = c("P5, P13", 
                          "P1, P5, P9, P13", 
                          "P1, P5, P9, P13", 
                          "P6, P14", 
                          "P6, P14",
                          "P8, P16", 
                          "P2, P6, P10, P14", 
                          "P2, P6, P10, P14", 
                          "P2, P5, P10, P13", 
                          "P2, P5, P10, P13", 
                          "P2, P6, P14", 
                          "P2, P6, P14")
Scenario_Name = c("Status Quo", 
                  "New Movement Line Expansion", 
                  "***Competitor Reaction", 
                  "Compete on Price", 
                  "***Competitor Reaction", 
                  "Compete on Price & Size",
                  "New Movement Products/Lower Price on all", 
                  "***Competitor Reaction", 
                  "New Movement Products with Lower Price", 
                  "***Competitor Reaction", 
                  "Line Expansion Covering Costs", 
                  "***Competitor Reaction")
RaceRiders_Offerings = c("P7","P7","P8","P7","P8","P8","P7","P8","P7","P8","P7","P8")
EarlyRiders_Profits = c((scenariosShare[1,6]*4000) * (111.99 - 33) - 20000 + (scenariosShare[1,14]*4000) * (111.99 - 33) - 20000,
                        ((scenariosShare[2,2]*4000) * (111.99 - 21) - 27000 + (scenariosShare[2,6]*4000) * (111.99 - 33) - 20000 +
                        (scenariosShare[2,10]*4000) * (111.99 - 21) - 27000 + (scenariosShare[2,14]*4000) * (111.99 - 33) - 20000),
                        ((scenariosShare[3,2]*4000) * (111.99 - 21) - 27000 + (scenariosShare[3,6]*4000) * (111.99 - 33) - 20000 +
                        (scenariosShare[3,10]*4000) * (111.99 - 21) - 27000 + (scenariosShare[3,14]*4000) * (111.99 - 33) - 20000),
                        ((scenariosShare[4,7]*4000) * (95.99 - 33) - 20000 + (scenariosShare[4,15]*4000) * (95.99 - 33) - 20000),
                        ((scenariosShare[5,7]*4000) * (95.99 - 33) - 20000 + (scenariosShare[5,15]*4000) * (95.99 - 33) - 20000),
                        0.5 * ((scenariosShare[7,9]*4000)) * (95.99 - 41) - 27000 + (scenariosShare[7,17]*4000) * (95.99 - 41) - 27000,
                        ((scenariosShare[8,3]*4000) * (95.99 - 21) - 27000 + (scenariosShare[8,7]*4000) * (95.99 - 33) - 20000 + 
                        (scenariosShare[8,11]*4000) * (95.99 - 21) - 27000 + (scenariosShare[8,15]*4000) * (95.99 - 33) - 20000),
                        ((scenariosShare[9,3]*4000) * (95.99 - 21) - 27000 + (scenariosShare[9,7]*4000) * (95.99 - 33) - 20000 + 
                        (scenariosShare[9,11]*4000) * (95.99 - 21) - 27000 + (scenariosShare[9,15]*4000) * (95.99 - 33) - 20000),
                        ((scenariosShare[10,3]*4000) * (95.99 - 21) - 27000 + (scenariosShare[10,6]*4000) * (111.99 - 33) - 20000 +
                        (scenariosShare[10,11]*4000) * (95.99 - 21) - 27000 + (scenariosShare[10,14]*4000) * (111.99 - 33) - 20000),
                        ((scenariosShare[11,3]*4000) * (95.99 - 21) - 27000 + (scenariosShare[11,6]*4000) * (111.99 - 33) - 20000 +
                        (scenariosShare[11,11]*4000) * (95.99 - 21) - 27000 + (scenariosShare[11,14]*4000) * (111.99 - 33) - 20000),
                        ((scenariosShare[12,3]*4000) * (95.99 - 21) - 27000 + (scenariosShare[12,7]*4000) * (95.99 - 33) - 20000 +
                        (scenariosShare[12,15]*4000) * (95.99 - 33) - 20000),
                        ((scenariosShare[13,3]*4000) * (95.99 - 21) - 27000 + (scenariosShare[13,7]*4000) * (95.99 - 33) - 20000 +
                        (scenariosShare[13,15]*4000) * (95.99 - 33) - 20000)
                        )
Competitor_Profits = c((scenariosShare[1,8]*4000) * (111.99 - 41) - 20000,
                       ((scenariosShare[2,8]*4000) * (111.99 - 41) - 20000), 
                       ((scenariosShare[3,9]*4000) * (95.99 - 41) - 20000), 
                       ((scenariosShare[4,8]*4000) * (111.99 - 41) - 20000), 
                       ((scenariosShare[5,9]*4000) * (95.99 - 41) - 20000),
                       0.5 * ((scenariosShare[7,9]*4000)) * (95.99 - 41) - 20000,
                       ((scenariosShare[8,8]*4000) * (111.99 - 41) - 20000), 
                       ((scenariosShare[9,9]*4000) * (95.99 - 41) - 20000),
                       ((scenariosShare[10,8]*4000) * (111.99 - 41) - 20000), 
                       ((scenariosShare[11,9]*4000) * (95.99 - 41) - 20000),
                       ((scenariosShare[12,8]*4000) * (111.99 - 41) - 20000), 
                       ((scenariosShare[13,9]*4000) * (95.99 - 41) - 20000)
                       )
EarlyRiders_Profits_in_1000s = EarlyRiders_Profits/1000
Competitor_Profits_in_1000s = Competitor_Profits/1000


ProfitDF = data.frame(Scenario_Name, EarlyRiders_Offerings, RaceRiders_Offerings, EarlyRiders_Profits_in_1000s, Competitor_Profits_in_1000s)
ProfitDF
write.csv(ProfitDF, "/Users/cameronbauer/Documents/Grad School Fall B/Analytics Design/A5/Profit.csv")
write.csv(scenariosShare, "/Users/cameronbauer/Documents/Grad School Fall B/Analytics Design/A5/MarketShare.csv")

```

Status Quo:
First we created the Status Quo scenario, which gave us an overview on the expected market that we would be looking to improve upon. This gave us a benchmark to measure the rest of our scenarios against. 

New Movement Line Expansion:
We first tried to introduce identical products, just with a different motion to our own into the market. This backfired as we ended up cannibalizing our other products market share.

Compete on Price:
Here we wanted to look at profitability if we reduced our price. It overall was okay, but ran the risk of the competition matching us at a lower price which severely lowered our profits.

Compete on Price and Size:
Here we wanted to see if the same scenario above but with larger size generated enough interest to compensate for the increase in costs. Here we would be competing directly with opponents lower priced version of the product P8, and although we assumed a 50% market split between us, the risk would be that consumer continue to purchase the competitors identical product over our own.

New Movement Products/Lower Price on all:
We wanted to see the impact of lowering the prices on all of the products offered in the New Movement Line Expansion. Here we saw that we did eat into our competitions market share by a bit, but the issue again lied with canibalizing our own products. Although we had a decent amount of market share in each of our four offerings, we were not selling enough models of most of our product lines to be profitable if challenged by a price decrease.

New Movement Products with Lower Price:
Here we wanted to see what would happen if we did add the new products, but kept our regular prices the same and made the new products cheaper. Because the new products were cheaper to produce than our traditional products, we felt as though offereing a cheaper alternative to our opponent would be easier to achieve while maintaining market share. However we again ended up canibalizing our own market share.

Line Expansion Covering Costs:
Here we wanted to see if we could lower the price of our original products, and cover it with the introduction of a bouncing horse product. This idea saw a decrease in market share for our competition in both the regular price and lowered price scenarios and saw our profits equal or come just under our original. 
